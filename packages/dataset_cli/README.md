# Davis CLI：データセット管理ツール

`davis-cli` は、行動モデル夏の学校で利用するデータセットを簡単に取得・管理するためのコマンドラインツールです。

> [!WARNING]
> 現在は行動モデル夏の学校の参加者のみが利用できます。

## 主な機能

- 利用可能なデータセットの一覧表示
- データセットの詳細情報の確認
- 指定したデータセットのダウンロード

## 1. インストール

現在、`davis-cli` は `uv` または `pip` を使ってGitリポジトリから直接インストールする必要があります。
（PyPIでの公開は予定していません。）

```bash
# uvを使う場合（推奨）
uv tool install git+https://github.com/bin-utokyo/davis#subdirectory=packages/dataset_cli

# pipを使う場合
pip install git+https://github.com/bin-utokyo/davis.git#subdirectory=packages/dataset_cli
```

## 2. 初回セットアップ

インストール後、最初に `setup` コマンドを実行して、データダウンロードに必要な認証情報を設定します。

```bash
davis setup
```

このコマンドを実行すると、以下の3つの情報を入力するよう求められます。

1. **Google Drive フォルダID**
2. **Google Cloud Client ID**
3. **Google Cloud Client Secret**

これらの情報は、データが保管されているGoogle Driveにアクセスするために必要です。以下に取得方法を詳しく説明します。

### 認証情報の取得方法

#### ステップ1: Google Cloudプロジェクトの作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスし、Googleアカウントでログインします。
2. 画面上部のプロジェクト選択メニューから「新しいプロジェクト」をクリックし、任意のプロジェクト名（例: `davis-data-access`）で新しいプロジェクトを作成します。

#### ステップ2: Google Drive APIの有効化

1. 作成したプロジェクトが選択されていることを確認し、左側のナビゲーションメニューから「APIとサービス」 > 「ライブラリ」を選択します。
2. 検索バーに「**Google Drive API**」と入力し、表示されたAPIをクリックします。
3. 「有効にする」ボタンをクリックして、APIを有効化します。

#### ステップ3: OAuth 2.0 クライアントIDの発行

1. 左側のナビゲーションメニューから「APIとサービス」 > 「認証情報」を選択します。
2. 画面上部の「認証情報を作成」をクリックし、「OAuth クライアント ID」を選択します。
3. 「同意画面を設定」を求められた場合は、以下の手順で設定します。
    - **User Type**: 「外部」を選択し、「作成」をクリックします。
    - **アプリ名**: `davis-cli` など、わかりやすい名前を入力します。
    - **ユーザーサポートメール**: ご自身のメールアドレスを選択します。
    - **デベロッパーの連絡先情報**: ご自身のメールアドレスを入力します。
    - 「保存して次へ」をクリックし、スコープの設定はスキップして「保存して次へ」をクリックします。
    - テストユーザーの画面で「ユーザーを追加」をクリックし、ご自身のGoogleアカウントのメールアドレスを追加して「保存して次へ」をクリックします。
4. 再度「認証情報」の画面に戻り、「認証情報を作成」 > 「OAuth クライアント ID」を選択します。
5. 「アプリケーションの種類」で「**デスクトップアプリ**」を選択します。
6. 名前に「davis-cli-local」などと入力し、「作成」をクリックします。
7. 作成が完了すると、「**クライアントID**」と「**クライアントシークレット**」が表示されます。これらをコピーして、`davis setup`コマンドのプロンプトに貼り付けてください。

#### ステップ4: Google Drive フォルダIDの取得

1. 管理者から共有されたGoogle Driveのフォルダにブラウザでアクセスします。
2. URLの末尾部分が**フォルダID**です。
    - 例: `https://drive.google.com/drive/folders/1a2b3c4d5e6f7g8h9i0j`
    - この場合、フォルダIDは `1a2b3c4d5e6f7g8h9i0j` です。

すべての情報を入力すると、設定がホームディレクトリの `.config/davis/config.ini` に保存され、ツールの準備が完了します。

## 3. データセットの利用方法

### 3.1. 利用可能なデータセットの一覧表示

`list` コマンドで、ダウンロード可能なデータセットの一覧を確認できます。

```bash
davis list
```

### 3.2. データセットの詳細情報を確認

`info` コマンドで、特定のデータセットに含まれるファイルやドキュメントの情報を確認できます。

```bash
davis info <DATASET_ID>
```

- `<DATASET_ID>` には、`list`コマンドで表示されたIDを指定します。
- `--open` オプションを付けると、関連ドキュメント（PDF）をブラウザで開きます。このドキュメントには、データセットの詳細な説明が含まれています。

```bash
# 例: PT_dataデータセットの情報を表示し、PDFをブラウザで開く
davis info PT_data --open
```

### 3.3. データセットのダウンロード

`get` コマンドで、データセットを手元にダウンロードします。

```bash
davis get <DATASET_ID>
```

ファイル単位でダウンロードすることもできますし、ディレクトリ単位でまとめてダウンロードすることも可能です。

- ダウンロード先のディレクトリを指定する場合は `--out` または `-o` オプションを使用します。

```bash
# 例: PT_dataデータセットを 'my_data' ディレクトリにダウンロードする
davis get PT_data -o my_data/
```

ダウンロードが始まると、初回のみブラウザが起動しGoogleの認証が求められます。許可すると、データのダウンロードが開始されます。

## 4. その他

### ヘルプの表示

各コマンドの詳細な使い方は、`--help` オプションで確認できます。

```bash
davis --help
davis list --help
davis info --help
davis get --help
```

この他のコマンドについても、同様に `--help` オプションで詳細を確認できます。

なお、`davis setup` コマンドは一度実行すれば再度実行する必要はありません。認証情報を更新したい場合にのみ再実行してください。

また、`davis manage` コマンドはデータセットの管理者向けの機能であり、一般ユーザーは使用する必要はありません。

## 5. サポート

問題や質問がある場合は、行動モデル夏の学校のSlackにて運営側にお問い合わせください。
